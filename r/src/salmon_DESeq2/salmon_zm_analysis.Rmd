---
title: "Salmon Analysis - ZM"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(DESeq2)
library("apeglm")
library("ashr")

library(org.Hs.eg.db)

load("../../../data/ZM_data.RData")
dds
results <- results(dds)
resultsNames(dds)

add_annotations_to_results <- function(res) {
  ens.str <- substr(rownames(res), 1, 15)
  res$symbol <- mapIds(org.Hs.eg.db,
                       keys=ens.str,
                       column="SYMBOL",
                       keytype="ENSEMBL",
                       multiVals="first")
  res$entrez <- mapIds(org.Hs.eg.db,
                       keys=ens.str,
                       column="ENTREZID",
                       keytype="ENSEMBL",
                       multiVals="first")
  return (res)
}

```


# ZM Analysis {.tabset}

## TIME - ZM T0 to T16
here

## TIME - ZM T0 to T20
here

## TIME - ZM T0 to T24
here

## TIME - ZM T0 to T36
here

## TIME - ZM T0 to T48

### Unrestricted
#### Summary
```{r}
results_t0_to_t48 <-
  results(dds, contrast = c("timepoint", "t48", "t0"))

results_t0_to_t48 = add_annotations_to_results(results_t0_to_t48)

summary(results_t0_to_t48)

```

### Restricted
#### Summary

```{r}
results_t0_to_t48_restricted <-
  results(
    dds,
    alpha = 0.1,
    ## We are looking for genes which have at least doubled, or decreased by more than half
    lfcThreshold = 1,
    contrast = c("timepoint", "t48", "t0")
  )
summary(results_t0_to_t48_restricted)

```
#### MA Plot
```{r}

plotMA(results_t0_to_t48_restricted)
```

### With LFC-Shrink
It is more useful visualize the MA-plot for the shrunken log2 fold changes, which remove the noise associated with log2 fold changes from low count genes without requiring arbitrary filtering thresholds.
```{r}
resultsNames(dds)
```

#### APE GLM
```{r}

results_t0_to_t48_shrunk <- lfcShrink(dds, coef="timepoint_t48_vs_t0", type="apeglm")
summary(results_t0_to_t48_shrunk)

```


###### MA Plot
```{r}

plotMA(results_t0_to_t48_shrunk)
```


#### ashr
```{r}

results_t0_to_t48_shrunk <- lfcShrink(dds, coef="timepoint_t48_vs_t0", type="ashr")
summary(results_t0_to_t48_shrunk)

```


###### MA Plot
```{r}

plotMA(results_t0_to_t48_shrunk)
```


## P-Adjusted Analysis
```{r}
## results_t0_to_t48
resSig <- subset(results_t0_to_t48, padj < 0.1) 
```

### Strongest Down Regulated Genes
```{r}
head(resSig[ order(resSig$log2FoldChange), ])
```

### Strongest up regulation
```{r}
head(resSig[ order(resSig$log2FoldChange, decreasing = TRUE), ])
```


